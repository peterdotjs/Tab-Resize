function getResizeParams(a){var b=a.split("-");return-1!==a.indexOf("scale")?{primaryRatio:Number(b[2]),secondaryRatio:Number(b[3]),orientation:b[5]}:{rows:Number(b[2]),cols:Number(b[3])}}function resizeTabs(a,b,c){var d={};d.numRows=b,d.numCols=c,initResizePreferences(d),setResizeWidthHeight(d,a,d.numRows,d.numCols),resizeTabHelper(d,a)}function resizeScaledTabs(a,b,c,d){var e={};e.numRows="horizontal"===d?1:2,e.numCols="horizontal"===d?2:1,initResizePreferences(e),setScaledResizeWidthHeight(e,a,b,c,d),resizeTabHelper(e,a,d)}function setScaledResizeWidthHeight(a,b,c,d,e){$.isEmptyObject(b)?(a.width="horizontal"===e?Math.round(.1*window.screen.availWidth*c):window.screen.availWidth,a.height="horizontal"===e?window.screen.availHeight:Math.round(.1*window.screen.availHeight*c)):(a.width="horizontal"===e?Math.round(.1*b.width*c):b.width,a.height="horizontal"===e?b.height:Math.round(.1*b.height*c))}function setResizeWidthHeight(a,b,c,d){$.isEmptyObject(b)?(a.width=Math.round(window.screen.availWidth/d),a.height=Math.round(window.screen.availHeight/c)):(a.width=Math.round(b.width/d),a.height=Math.round(b.height/c))}function resizeTabHelper(a,b,c){$.isEmptyObject(b)?(a.offsetX=0,a.offsetY=0,a.fullWidth=window.screen.availWidth,a.fullHeight=window.screen.availHeight):(a.offsetX=b.left,a.offsetY=b.top,a.fullWidth=b.width,a.fullHeight=b.height),window.chrome.tabs.query({currentWindow:!0},function(b){a.tabsArray=b,window.chrome.tabs.query({currentWindow:!0,highlighted:!0},function(b){a.currentTab=b[0];var d=a.currentTab.index;b.length>1&&(a.tabsArray=b,d=0);var e=function(){return util.processTabs(a,a.tabsArray,d,a.currentTab.windowId,a.singleTab,a.dismissAfter,a.currentTab.incognito,c)};a.singleTab?util.setUndoStorage(a,a.currentTab.index,a.currentTab.windowId,a.tabsArray.slice(d,d+1),e):util.setUndoStorage(a,a.currentTab.index,a.currentTab.windowId,a.tabsArray.slice(d),e)})})}function initResizePreferences(a){var b=localStorage.getItem("singleTab");b&&"true"===b&&(a.singleTab=!0);var c=localStorage.getItem("emptyTab");c&&"true"!==c||(a.emptyTab=!0);var d=localStorage.getItem("alignment");a.alignment=d||"left"}function disableUndoButton(a){a.lastTab=null,localStorage.removeItem("lastTab")}function sendTracking(a,b){var c=localStorage.getItem("tracking-opt-out"),d=!1;c&&"true"===c&&(d=!0),!d&&ga&&ga("send","event",a,"clicked",b||"na")}chrome.runtime.onUpdateAvailable.addListener(function(a){localStorage.getItem("version")<a.version&&chrome.runtime.reload()}),chrome.runtime.onInstalled.addListener(function(a){if(a){var b=a.reason;"install"===b?sendTracking("install","install"):"update"===b&&sendTracking("install","update")}});var curVersion=localStorage.getItem("version")||"",isOldVersion=curVersion<"2.3.4"&&""!==curVersion;curVersion||localStorage.setItem("version","2.2.0"),localStorage.getItem("updateBadge")&&!isOldVersion||(localStorage.setItem("updateBadge",0),chrome.browserAction.setBadgeText({text:"NEW"}),chrome.browserAction.setBadgeBackgroundColor({color:[221,129,39,255]})),isOldVersion&&localStorage.removeItem("update-seen");var util={createNewWindow:function(a,b,c,d,e,f,g){var h={left:b,top:c,width:d,height:e,incognito:f};a&&($.isArray(a)?h.tabId=a[0]:h.tabId=a),window.chrome.windows.create(h,function(b){g(b,a)})},processTabs:function(a,b,c,d,e,f,g,h){for(var i,j,k=b.slice(c),l=0,m=0,n=k.length,o=a.numRows*a.numCols-n,p=this,q=function(b,c){!c&&a.emptyTab?(k.push(b.tabs[0]),m++,o===m&&p.updateUndoStorage(a,k)):c&&$.isArray(c)&&chrome.tabs.move(c.slice(1),{windowId:b.id,index:1})},r=function(){f&&chrome.runtime.sendMessage({close:"foreground"})},s=0;s<a.numRows;s++)for(var t=0;t<a.numCols;t++){if(j="left"===a.alignment?t*a.width+a.offsetX:a.fullWidth-(t+1)*a.width+a.offsetX,topValue=s*a.height+a.offsetY,0===t&&0===s){if(window.chrome.windows.update(k[l].windowId,{left:j,top:topValue,width:a.width,height:a.height,state:"normal"}),e)return void r()}else{if(!(i=k[l]?k[l].id:null)&&!a.emptyTab)return void r();if(s===a.numRows-1&&t===a.numCols-1&&n-l>1){i=[];for(var u=l;u<n;u++)i.push(k[u].id)}h&&("horizontal"===h?(a.width=a.fullWidth-a.width,"left"!==a.alignment&&(j=a.offsetX)):a.height=a.fullHeight-a.height),p.createNewWindow(i,j,topValue,a.width,a.height,g,q)}l++}r()},setUndoStorage:function(a,b,c,d,e){window.chrome.windows.get(c,{},function(a){var f={left:a.left,top:a.top,width:a.width,height:a.height,focused:!0,state:"normal",incognito:a.incognito},g={};g.lastWindowInfo=f,g.lastTabIndex=b,g.lastWindowId=c;for(var h=[],i=0;i<d.length;i++)h.push(d[i].id);g.lastTabsArray=h,localStorage.setItem("lastTab",JSON.stringify(g)),chrome.runtime.sendMessage("enable-undo"),e()})},updateUndoStorage:function(a,b){for(var c=JSON.parse(localStorage.getItem("lastTab")),d=[],e=0;e<b.length;e++)d.push(b[e].id);c&&(c.lastTabsArray=d,localStorage.setItem("lastTab",JSON.stringify(c)),chrome.runtime.sendMessage("enable-undo"))},undoResize:function(a,b){var c=this,d=localStorage.getItem("lastTab");if(d){a.lastTab=JSON.parse(d);var e=a.lastTab.lastTabIndex,f=a.lastTab.lastWindowId,g=a.lastTab.lastTabsArray;window.chrome.windows.get(f,{},function(d){d?c.recombineTabs(a,e,f,g,b):chrome.tabs.query({status:"complete"},function(d){for(var e={},f=[],h=0;h<d.length;h++)e[d[h].id]=!0;for(var i=0;i<g.length;i++)e[g[i]]&&f.push(g[i]);0!==f.length?chrome.windows.create({tabId:f[0]},function(d){c.recombineTabs(a,1,d.id,f.slice(1),b)}):(a.isMac||alert("Previous tabs were closed."),b&&b())})})}},recombineTabs:function(a,b,c,d,e){var f=b;window.chrome.tabs.move(d,{windowId:c,index:f});var g=a.lastTab.lastWindowInfo,h=$.extend(!0,{},g);delete h.incognito,window.chrome.windows.update(c,h),e&&e()},displayInfoFormatter:function(a,b){for(var c,d=0,e=a.length,f={displays:[],primaryIndex:0};d<e;d++)c=a[d],c.id=String(d),f.displays.push({workArea:c.workArea,isEnabled:c.isEnabled,id:c.id}),b.left>c.workArea.left&&b.left<c.workArea.left+c.workArea.width&&b.top>c.workArea.top&&b.top<c.workArea.top+c.workArea.height&&(f.primaryIndex=d);return f}};!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-34217520-2","auto"),ga("set","checkProtocolTask",function(){}),ga("require","displayfeatures"),chrome.commands.onCommand.addListener(function(a){if(-1!==a.indexOf("tab-resize")){if(-1!==a.indexOf("undo")){var b={};return util.undoResize(b,function(){disableUndoButton(b)}),void sendTracking("undo","undo-shortcut")}chrome.system&&chrome.system.display&&chrome.system.display.getInfo(function(b){chrome.windows.getCurrent(function(c){var d={left:c.left+c.width-100,top:c.top+100},e=util.displayInfoFormatter(b,d),f=-1!==a.indexOf("scale"),g=getResizeParams(a);sendTracking("keyboard-shortcut",a),f?resizeScaledTabs(e.displays[e.primaryIndex].workArea,g.primaryRatio,g.secondaryRatio,g.orientation):resizeTabs(e.displays[e.primaryIndex].workArea,g.rows,g.cols)})})}});